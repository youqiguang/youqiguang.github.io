<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¥³å·«çš„æ¯’è¯ âœ¨ éœ‡åŠ¨åŠ å¼ºç‰ˆ</title>
    <style>
        /* --- åŸºç¡€è®¾ç½® (ä¿æŒåŸå‘³ï¼Œä¸åšæ”¹åŠ¨) --- */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Nunito', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(180deg, #FF9A9E 0%, #FECFEF 99%, #FECFEF 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            color: #555;
            overflow-x: hidden;
            user-select: none; /* é˜²æ­¢é•¿æŒ‰é€‰ä¸­æ–‡å­— */
        }
        .bg-decor { position: fixed; font-size: 2rem; opacity: 0.3; animation: floatBackground 6s infinite ease-in-out; z-index: 0; pointer-events: none; }
        @keyframes floatBackground { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
        
        /* --- å®¹å™¨ --- */
        .game-container {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 35px;
            padding: 30px 20px;
            width: 100%;
            max-width: 480px;
            box-shadow: 0 15px 35px rgba(255, 105, 135, 0.3);
            position: relative;
            z-index: 10;
            text-align: center;
            transition: all 0.3s ease;
        }

        /* --- æŒ‰é’® --- */
        button { border: none; outline: none; cursor: pointer; font-family: inherit; }
        .main-btn {
            background: linear-gradient(45deg, #FF9A9E 0%, #FECFEF 100%);
            color: #fff;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: 800;
            border-radius: 50px;
            box-shadow: 0 8px 20px rgba(255, 154, 158, 0.5);
            transition: all 0.2s;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            width: 80%;
            margin-top: 20px;
        }
        .main-btn:active { transform: scale(0.95); box-shadow: 0 4px 10px rgba(255, 154, 158, 0.4); }
        
        /* æ¬¡è¦æŒ‰é’®ï¼ˆç”¨äºå›é¦–é¡µï¼‰ */
        .secondary-btn {
            background: transparent;
            color: #888;
            border: 2px solid #eee;
            margin-top: 10px;
            padding: 10px 30px;
            border-radius: 50px;
            font-weight: bold;
        }

        /* --- å±å¹• --- */
        .screen { display: none; animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        /* --- é¦–é¡µå…ƒç´  --- */
        .title-emoji { font-size: 4rem; margin-bottom: 10px; display: inline-block; animation: wiggly 2s infinite; }
        @keyframes wiggly { 0%, 100% { transform: rotate(-5deg); } 50% { transform: rotate(5deg); } }
        h1 { color: #FF6B6B; font-size: 2rem; margin-bottom: 10px; }
        .desc { color: #888; margin-bottom: 20px; line-height: 1.6; }

        /* --- æ¸¸æˆåŒº --- */
        .progress-bar-bg { background: #eee; height: 12px; border-radius: 10px; overflow: hidden; margin: 0 auto 20px; width: 80%; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #a18cd1 0%, #fbc2eb 100%); width: 0%; transition: width 0.5s ease; }
        .round-info h2 { color: #a18cd1; font-size: 1.8rem; }
        .hint { color: #FF8E53; font-weight: bold; margin-bottom: 20px; font-size: 1rem; min-height: 1.5em;}

        .mushroom-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 20px; }
        .mushroom-card {
            background: white; border-radius: 20px; padding: 15px 5px;
            box-shadow: 0 8px 15px rgba(0,0,0,0.05); cursor: pointer;
            transition: all 0.2s ease; position: relative; border: 3px solid #f0f0f0;
        }
        .mushroom-card:active { transform: scale(0.9); }
        .m-emoji { font-size: 3rem; display: block; line-height: 1.2; transition: all 0.3s; }
        .m-num { font-size: 0.9rem; color: #aaa; font-weight: bold; }

        /* åŠ¨ç”»ç±» */
        .shaking { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both infinite; border-color: #FF9A9E; background: #FFF0F5; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0) rotate(-2deg); }
            20%, 80% { transform: translate3d(2px, 0, 0) rotate(2deg); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0) rotate(-4deg); }
            40%, 60% { transform: translate3d(4px, 0, 0) rotate(4deg); }
        }

        /* æ­ç§˜æ¯’è¯æ ·å¼ */
        .reveal-poison { opacity: 0.5; background: #ddd !important; filter: grayscale(100%); }
        .reveal-poison .m-emoji { transform: scale(0.8); }

        /* --- ç»“æœ --- */
        .result-icon { font-size: 5rem; margin: 10px 0; }
        .correct-text { color: #4FACFE; }
        .wrong-text { color: #FF6B6B; }

        /* æ’’èŠ± */
        .confetti { position: absolute; width: 10px; height: 10px; background-color: #f00; animation: fall 3s linear forwards; z-index: 5; pointer-events: none; }
        @keyframes fall { to { transform: translateY(500px) rotate(720deg); opacity: 0; } }
    </style>
</head>
<body>

    <div class="bg-decor" style="top: 10%; left: 5%;">âœ¨</div>
    <div class="bg-decor" style="top: 20%; right: 10%;">ğŸ„</div>
    <div class="bg-decor" style="bottom: 15%; left: 10%;">ğŸŒŸ</div>
    <div class="bg-decor" style="bottom: 5%; right: 5%;">ğŸŒ¸</div>

    <div class="game-container">
        
        <div id="homeScreen" class="screen" style="display: block;">
            <div class="title-emoji">ğŸ§™â€â™€ï¸ğŸ¬</div>
            <h1>å¥³å·«çš„ç›²ç›’</h1>
            <p class="desc">
                æ£®æ—é‡Œæœ‰ä¸€é”…è˜‘è‡æ±¤...<br>
                åªæœ‰ <b>1ä¸ª</b> æ˜¯å‰§æ¯’çš„ï¼<br>
                å‡­ç›´è§‰é€‰å‡ºèƒ½åƒçš„è˜‘è‡ï¼
            </p>
            <button class="main-btn" onclick="startGame()">å¼€å§‹ä½œæ­» (à¸‡ â€¢_â€¢)à¸‡</button>
        </div>

        <div id="gameScreen" class="screen">
            <div class="progress-bar-bg">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <div class="round-info">
                <h2 id="roundTitle">ç¬¬ 1 å…³</h2>
                <p class="hint" id="hintText">...</p>
            </div>

            <div class="mushroom-grid" id="mushroomGrid"></div>
        </div>

        <div id="resultScreen" class="screen">
            <div class="result-icon" id="resultEmoji">ğŸ˜³</div>
            <h2 id="resultTitle">ç»“æœæ˜¯...</h2>
            <p id="resultMessage" class="desc" style="margin-top:10px;">...</p>
            
            <button id="actionBtn" class="main-btn" onclick="">ä¸‹ä¸€å…³</button>
            <br>
            <button class="secondary-btn" onclick="goHome()">å›é¦–é¡µ ğŸ </button>
        </div>

        <div id="finalScreen" class="screen">
            <div class="title-emoji">ğŸ†ğŸ‰</div>
            <h2 style="color:#4facfe">æ¬§çš‡é™ä¸´ï¼</h2>
            <p class="desc">
                ä¸å¯æ€è®®ï¼<br>
                ä½ å®Œç¾é¿å¼€äº†æ‰€æœ‰æ¯’è¯ï¼<br>
                ä»Šæ™šçš„è˜‘è‡æ±¤å½’ä½ äº†ï¼
            </p>
            <button class="main-btn" onclick="startGame()">å†æ¥ä¸€å±€ ğŸ”„</button>
            <br>
            <button class="secondary-btn" onclick="goHome()">å›é¦–é¡µ ğŸ </button>
        </div>

    </div>

    <script>
        // æ¸¸æˆé…ç½®
        const gameConfig = [
            { count: 6, hint: '6é€‰1ï¼Œè¿™å±€å¾ˆç®€å•çš„~' },
            { count: 5, hint: 'éš¾åº¦å‡çº§ï¼æ‰‹åˆ«æŠ–å“¦~' },
            { count: 4, hint: 'ç©ºæ°”çªç„¶å®‰é™äº†...' },
            { count: 3, hint: '33%çš„æ­»äº¡ç‡ï¼Œä½ æ•¢ç‚¹å—ï¼Ÿ' }
        ];

        let currentRound = 0;
        let poisonIndex = -1;
        let isProcessing = false;

        // --- æ ¸å¿ƒå·¥å…·å‡½æ•° ---

        // éœ‡åŠ¨åé¦ˆ (æ ¸å¿ƒå‡çº§ç‚¹)
        function vibrate(pattern) {
            if (navigator.vibrate) {
                navigator.vibrate(pattern);
            }
        }

        function switchScreen(screenId) {
            document.querySelectorAll('.screen').forEach(el => el.style.display = 'none');
            document.getElementById(screenId).style.display = 'block';
        }

        // --- æ¸¸æˆæµç¨‹ ---

        // å›é¦–é¡µ (ä¿®å¤ç‚¹ï¼šé‡ç½®æ•°æ®å¹¶åˆ‡å±)
        function goHome() {
            currentRound = 0;
            document.getElementById('progressFill').style.width = '0%';
            switchScreen('homeScreen');
        }

        function startGame() {
            currentRound = 0;
            loadRound();
            switchScreen('gameScreen');
        }

        function loadRound() {
            const config = gameConfig[currentRound];
            
            // æ›´æ–°UI
            document.getElementById('roundTitle').innerText = `ç¬¬ ${currentRound + 1} å…³`;
            document.getElementById('hintText').innerText = config.hint;
            
            // è¿›åº¦æ¡
            const percent = ((currentRound) / gameConfig.length) * 100;
            document.getElementById('progressFill').style.width = `${percent}%`;

            // ç”Ÿæˆæ¯’è¯
            poisonIndex = Math.floor(Math.random() * config.count);
            
            // æ¸²æŸ“è˜‘è‡
            const grid = document.getElementById('mushroomGrid');
            grid.innerHTML = '';

            for (let i = 0; i < config.count; i++) {
                const btn = document.createElement('div');
                btn.className = 'mushroom-card';
                btn.id = `mushroom-${i}`; // æ ‡è®°IDæ–¹ä¾¿æŸ¥æ‰¾
                btn.innerHTML = `
                    <span class="m-emoji">ğŸ„</span>
                    <span class="m-num">${i + 1}</span>
                `;
                btn.onclick = () => handlePick(i, btn);
                grid.appendChild(btn);
            }
            isProcessing = false;
        }

        function handlePick(index, element) {
            if (isProcessing) return;
            isProcessing = true;

            // 1. ç´§å¼ é˜¶æ®µï¼šéœ‡åŠ¨ + åŠ¨ç”»
            element.classList.add('shaking');
            element.querySelector('.m-emoji').innerText = 'ğŸ˜–';
            vibrate(50); // çŸ­éœ‡ä¸€ä¸‹

            // 2. æ­æ™“ç»“æœ (0.8ç§’å)
            setTimeout(() => {
                element.classList.remove('shaking');
                
                if (index === poisonIndex) {
                    // --- è¸©é›·äº† (å¤§éœ‡åŠ¨) ---
                    vibrate([100, 50, 100, 50, 200]); 
                    element.style.background = '#ffe0e0';
                    element.querySelector('.m-emoji').innerText = 'â˜ ï¸';
                    showResult(false, index);
                } else {
                    // --- é€‰å¯¹äº† (è½»å¾®åé¦ˆ) ---
                    vibrate(50);
                    element.style.background = '#e0fff0';
                    element.querySelector('.m-emoji').innerText = 'ğŸ²';
                    
                    // è¶£å‘³åŠŸèƒ½ï¼šçŸ­æš‚æ˜¾ç¤ºæ¯’è¯åœ¨å“ªé‡Œ (æ­»é‡Œé€ƒç”Ÿæ„Ÿ)
                    revealPoisonTemp();

                    setTimeout(() => {
                         showResult(true, index);
                    }, 1200); // ç¨å¾®å¤šç•™ç‚¹æ—¶é—´è®©ç”¨æˆ·çœ‹æ¸…æ¯’è¯åœ¨å“ª
                }
            }, 800);
        }

        // è¶£å‘³åŠŸèƒ½ï¼šæŠŠæ¯’è¯é‚£ä¸ªæ ¼å­çŸ­æš‚æ˜¾ç¤ºå‡ºæ¥
        function revealPoisonTemp() {
            const poisonEl = document.getElementById(`mushroom-${poisonIndex}`);
            if(poisonEl) {
                poisonEl.classList.add('reveal-poison');
                poisonEl.querySelector('.m-emoji').innerText = 'â˜ ï¸';
            }
        }

        function showResult(isSuccess, pickIndex) {
            switchScreen('resultScreen');
            const emoji = document.getElementById('resultEmoji');
            const title = document.getElementById('resultTitle');
            const msg = document.getElementById('resultMessage');
            const btn = document.getElementById('actionBtn');

            // éšæœºè¶£å‘³æ–‡æ¡ˆåº“
            const winQuotes = ["è¿æ°”çœŸå¥½ï¼", "è¿™ä¹Ÿè¡Œï¼Ÿ", "å¤©é€‰ä¹‹å­ï¼", "åˆšæ‰å¥½é™©..."];
            const loseQuotes = ["ä»Šæ™šæ²¡é¥­åƒäº†...", "å¥³å·«æŠŠä½ ç‚–äº†ï¼", "å°±å·®ä¸€ç‚¹ç‚¹ï¼", "è¿™ä¹Ÿæ˜¯ä¸€ç§è¿æ°”..."];

            if (isSuccess) {
                emoji.innerText = ['ğŸ˜‹', 'âœ¨', 'ğŸ‰'][Math.floor(Math.random()*3)];
                title.innerText = 'å®‰å…¨é€šè¿‡ï¼';
                title.className = 'correct-text';
                
                const randomQuote = winQuotes[Math.floor(Math.random() * winQuotes.length)];
                msg.innerHTML = `<b>${pickIndex + 1}å·</b> æ˜¯æ— æ¯’çš„ï¼<br><span style="color:#aaa;font-size:0.9em">${randomQuote}</span>`;
                
                if (currentRound >= gameConfig.length - 1) {
                    btn.innerText = 'é¢†å–å¤§å¥– ğŸ';
                    btn.onclick = () => {
                        createConfetti();
                        switchScreen('finalScreen');
                    };
                } else {
                    btn.innerText = 'ä¸‹ä¸€å…³ âœ';
                    btn.onclick = () => {
                        currentRound++;
                        loadRound();
                        switchScreen('gameScreen');
                    };
                }

            } else {
                emoji.innerText = 'ğŸ‘»';
                title.innerText = 'æ¸¸æˆç»“æŸ';
                title.className = 'wrong-text';
                
                const randomQuote = loseQuotes[Math.floor(Math.random() * loseQuotes.length)];
                msg.innerHTML = `å“å‘€ï¼<b>${pickIndex + 1}å·</b> æ­£æ˜¯æ¯’è¯ï¼<br><span style="color:#aaa;font-size:0.9em">${randomQuote}</span>`;
                
                btn.innerText = 'ä¸æœï¼Œé‡æ¥ ğŸ˜¤';
                btn.onclick = () => startGame();
            }
        }

        function createConfetti() {
            vibrate([50, 50, 50]); // åº†ç¥éœ‡åŠ¨
            for(let i=0; i<40; i++) {
                const div = document.createElement('div');
                div.className = 'confetti';
                div.style.left = Math.random() * 100 + '%';
                div.style.backgroundColor = ['#ff0', '#f00', '#0f0', '#00f', '#f0f'][Math.floor(Math.random()*5)];
                div.style.animationDuration = (Math.random() * 2 + 1) + 's';
                document.body.appendChild(div);
                setTimeout(() => div.remove(), 3000);
            }
        }
    </script>
</body>
</html>